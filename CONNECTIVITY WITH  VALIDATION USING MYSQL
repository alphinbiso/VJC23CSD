<!DOCTYPE html>
<html>
<head>
<title>Patient Registration</title>
</head>
<body>
 <form method="POST">
 <table>
 <tr>
    <td><label>Patient Name:</label></td>
	<td><input type="text" name="name"></td>
</tr>
<tr>
    <td><label>Age:</label></td>
	<td><input type="number" name="age"></td>
</tr>
<tr>
	<td><label>Gender:</label></td>
	<td><input type="radio" id="m" name="gender" value="male" >Male</td>
    <td><input type="radio" id="f" name="gender" value="female">Female</td>
    <td><input type="radio" id="oth" name="gender" value="other">Other</td>
</tr>
<tr>
	<td><label>Address:</label></td>
	<td><textarea rows="5" cols="28" style="align-right:30px" name="address"></textarea></td>
</tr>
<tr>
	<td><label>Contact:</label></td>
	<td><input type="text" name="contact"></td>
</tr>
<tr>
	<td><label>Disease:</label></td>
	<td><input type="text" name="disease"></td>
</tr>
<tr>
	<td><input type="submit" name="submit" style="margin-left:100%" value="Register"></td>
</tr>
</table>
 </form>
    <h2>Search with name</h2>
        <form method="post" action="">
            <input type="text" name="search_query" placeholder="Search Patient">
            <input type="submit" name="ser" value="Search">
</form>
<?php 
if(isset($_POST['submit']))
{
$name=$_POST['name'];
$age=$_POST['age'];
$gender=$_POST['gender'];
$address=$_POST['address']; 
$contact=$_POST['contact'];
$disease=$_POST['disease']; 

if(!preg_match("/^[a-zA-Z ]*$/",$name))
{
    echo "Only letters and white space allowed in name";
    return;
}
if(!preg_match("/^[0-9]*$/",$age))
{
    echo "Only numbers are allowed in age";
    return;
}
if(is_null($gender))
{
    echo "Gender not selected";
    return;     
}
if(is_null($address))
{
    echo "aaddress is empty";
    return;     
}
if(!preg_match("/^\d{10}$/",$contact))
{
    echo "Only numbers are allowed in contact";
    return;
}
if(!preg_match("/^[a-zA-Z ]*$/",$disease))
{
    echo "Only letters and white space allowed in disease";
    return;
}

 echo "All inputs are valid";
}
// ---------- Database Connection ----------

$servername = "localhost";
$username = "root";
$password = "";

$conn = new mysqli($servername, $username,$password);
if ($conn->connect_error) {
  die("<br>Connection failed: " .$conn->connect_error);
}
else
{
  	 echo "<br>connection established successfully";
	
}
 $sql = "CREATE DATABASE IF NOT EXISTS PatientDB";
if($conn->query($sql)===true)
{
	echo"<br>database created successfully";

}
else
	echo"<br>error occured".$conn->connect_error;
mysqli_select_db($conn,"PatientDB");
$sql = "CREATE TABLE IF NOT EXISTS Patients(
    patient_id INT(6) AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    age INT(3) NOT NULL,
    gender VARCHAR(10) NOT NULL,
    address VARCHAR(255) NOT NULL,
    contact VARCHAR(15) NOT NULL,
    disease VARCHAR(50) NOT NULL
)";

if($conn->query($sql)===TRUE)
{
	echo"<br>Table created successfully";

}
else
{
	echo"<br>error occured".$conn->connect_error;
}
if(isset($_POST['submit']))
{ $name=$_POST['name'];
$age=$_POST['age'];
$gender=$_POST['gender'];
$address=$_POST['address']; 
$contact=$_POST['contact'];
$disease=$_POST['disease']; 
  
$sql = "INSERT INTO Patients (name, age, gender, address, contact, disease)
VALUES ('$name', '$age', '$gender', '$address', '$contact', '$disease')";
if($conn->query($sql)===TRUE)
{
    echo"<br>Values inserted created successfully";

}
else
{
    echo"<br>error occured while inserting".$conn->connect_error;
}
}

if(isset($_POST['ser']))
{
$search=$_POST['search_query'];   
$sql="SELECT * FROM Patients WHERE name LIKE '%$search%'";
$result=$conn->query($sql); 
 if ($result->num_rows>0) {
    echo "<table border='2' cellpadding='10'>
            <tr>
              <th>Patient Name</th>
              <th>Age</th>
              <th>Gender</th>
              <th>Address</th>
              <th>Contact</th>
              <th>Disease</th>
            </tr>";
    while ($row = $result->fetch_assoc()) {
      echo "<tr>
              <td>".$row['name']."</td>
              <td>".$row['age']."</td>
              <td>".$row['gender']."</td>
              <td>".$row['address']."</td>
              <td>".$row['contact']."</td>
              <td>".$row['disease']."</td>
            </tr>";
    }
    echo "</table>";
  } else {
    echo "<h3>zero results<br></h3>";
  }
  
}
$conn->close();
?>
</body>
</html>
